<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ECharts 碳转移图</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <style>
        html, body{
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        #main {
            width: 1000px; /* 设置图表的宽度 */
            height: 1000px; /* 设置图表的高度 */
            position: relative; /* 使子元素可以使用绝对定位 */
        }

        /* 实际是720*720的矩形 */
        #heatmap { 
            position: absolute;
            width: 80%; 
            height: 80%; 
            /* background-color: lightblue; 背景颜色仅用于演示 */
        }

        #bar-b {
            position: absolute;
            /* top: 0; */
            left: 80%; 
            width: 10%; 
            height: 80%; 
            /* background-color: lightcoral; 背景颜色仅用于演示 */
        }

        #bar-a {
            position: absolute;
            top: 80%; 
            width: 100%; 
            height: 10%; 
            /* background-color: lightgreen; 背景颜色仅用于演示 */
        }
    </style>
</head>

<body>
  <!-- 创建一个用于放置图表的容器 -->
   <div id="main">
        <div id="heatmap"></div>
        <div id="bar-a"></div>
        <div id="bar-b"></div>
   </div>

  
  <script>
        const yData =  ["BJ", "TJ", "HE", "SX", "IM", "LN", "JL", "HL", "SH", "JS", "ZJ", "AH", "FJ", "JX", "SD", "HA", "HB", "HN", "GD", "GX", "HI", "CQ", "SC", "GZ", "YN", "SN", "GS", "QH", "NX", "XJ"];
        
        const xData =  ["BJ", "TJ", "HE", "SX", "IM", "LN", "JL", "HL", "SH", "JS", "ZJ", "AH", "FJ", "JX", "SD", "HA", "HB", "HN", "GD", "GX", "HI", "CQ", "SC", "GZ", "YN", "SN", "GS", "QH", "NX", "XJ"];
        
        const provinces = ["北京", "天津", "河北", "山西", "内蒙古", "辽宁", "吉林", "黑龙江", "上海","江苏", "浙江", "安徽", "福建", "江西", "山东", "河南", "湖北", "湖南", "广东","广西", "海南", "重庆", "四川", "贵州", "云南", "陕西", "甘肃", "青海", "宁夏", "新疆"]

        // 用的静态数据
        const matrix = [[13.2081604599,0.5328968923,0.6727340419,0.5491470344,1.1661628045,0.4974954515,1.7298600275,0.3247719321,0.7887512177,1.5932957544,1.3898562022,2.3551560078,0.4283664764,0.5781513329,0.9132377952,1.2800462583,0.9782304821,0.3472383572,0.82441299,0.2699527748,0.0766638485,1.2065086538,0.2487357808,0.3093753325,0.3570125325,1.8343682925,0.3885132663,0.0940608109,0.2713124375,0.3606022877],[4.3274147798,76.3142775194,3.79806947,2.0545741374,6.0336881929,2.4159169705,10.6654989922,1.6181119619,3.7735635276,12.5931964039,9.9493067119,12.1777979089,2.0883029393,1.5857858145,3.4990688679,5.6356716472,2.3240802097,1.7113855432,4.5238725824,1.3068001244,0.5196406381,6.5373043548,1.555624456,2.2045789577,1.2010916546,10.3454903004,2.60961957,0.5435195131,1.6606640493,2.5538640637],[21.1007248412,9.2906168012,658.3134852756,14.3537203258,11.6294627921,14.0202422899,6.9217519046,8.0856922585,11.7360142502,86.9396451787,80.6301711501,26.1302612534,8.0562263305,6.3026857832,14.9444087901,31.2542992484,6.0937357722,11.4122534338,21.7556938331,5.9443001013,3.6627795873,22.7993434242,12.7451796077,5.9231652495,6.3877940806,12.7182560273,4.6794013434,1.1380829867,2.2600941235,4.5223473993],[8.6262073996,5.1762274551,10.5586098798,376.0259090357,7.154408789,4.8545437566,5.3372892075,2.9744669272,9.2887614572,29.8229827924,19.0708163666,9.6396843902,4.7898199222,6.9036652717,11.7983375749,14.5592246733,14.5061327883,7.6373886746,17.4990992914,3.4585807928,0.7701700346,5.4629047298,2.5512837524,2.7418338038,2.8362835764,6.4253210485,1.9565650385,0.8611372771,1.1554126742,2.1978535669],[17.484094592,9.9324943952,21.6980550863,14.4668263435,508.664371558,14.1040700942,9.5931098495,11.4912731002,22.6539427682,86.6188599915,73.5588345478,26.0945168228,13.1265914453,12.4769884051,18.6450404372,24.8443452333,25.9608199133,16.5768172368,35.4448986819,5.5786099001,2.9723819139,16.9300287303,8.1447364978,5.5383351874,6.368225181,17.3020950116,9.4374157582,1.7248475399,6.5945833122,8.8670220163],[8.0477949088,5.3385187263,7.6534895617,5.1624941608,9.6314782566,292.1784501949,33.304161942,5.2036382943,8.6870498177,29.1678716624,27.7106701018,22.2896753491,4.6174992215,3.8127774261,8.7777627445,12.9206333388,4.648631005,4.5520808175,8.1466435947,3.0232181864,1.1451373227,12.5763396752,3.6893265158,4.0104748038,3.0992874399,16.857686691,4.427904029,0.8692325034,2.9047580711,4.4534279032],[5.7847674575,4.9540084065,3.9516173438,5.7122402655,5.0682170054,6.3365617019,199.1115379166,4.6793644025,7.8769005551,13.9441079189,15.3554651476,3.9934439789,3.8211407625,2.3870104155,4.8812011637,6.4972909196,2.8428531935,1.8910022794,7.1005073542,1.2455811331,0.4276754634,2.60029097,1.3161702904,1.3752304972,1.5111896665,5.0084182185,1.3972514109,0.3046079289,1.8292557631,1.9186561715],[3.5695654931,2.6609789326,3.8232534874,2.9336564583,4.9410018564,3.6909343486,22.0763135954,64.0731220406,5.3943828748,11.2588739387,9.4375424207,10.920423792,2.5530591736,2.1575554671,4.5841047483,5.9932412772,3.0267183402,1.72160779,5.268974178,1.1160009407,0.3642391901,4.6465302419,1.0037690997,1.4884421096,1.1363902267,8.2343101546,1.8510840102,0.3695415898,1.6738835575,2.1786596398],[1.6442206549,0.9594134996,2.0218961123,1.4064474987,2.5327955072,1.7036206592,5.3658545859,1.0578391696,57.1616369011,7.3063298432,6.5277070382,10.025279536,1.4502993527,1.2050133629,2.7816372427,4.8381957198,1.2793422935,1.2688567919,4.153965107,1.2983140375,0.3602232116,3.8889827238,0.9588272963,1.6591504555,1.1887307711,5.9922335316,1.4812106133,0.2808048739,0.8561946542,1.5179587771],[8.0614166465,11.0387438406,21.8348237817,7.4910707213,14.5213111685,13.3971350033,4.406672112,3.6190174281,9.7679969617,903.494172048,30.0005619472,25.442283733,4.9988992479,12.8064244806,15.3697314378,37.9959363923,3.8691636663,10.5173394797,30.2920837101,10.6668398396,1.7021325427,8.0568208265,6.7644999006,5.8362720048,10.1380674089,12.0648296569,7.1811805952,2.2267713276,2.5258554957,4.004299372],[3.1139511023,2.7541370485,7.658472342,4.1384966398,4.2521926128,3.9536306682,9.3477452379,2.4670143855,5.986356857,14.8826349255,253.4918658006,18.5324469147,3.1467526922,4.4993159671,7.2919365397,13.3652575934,3.2998170345,4.3667954425,7.8400045486,3.3491854335,0.7187057532,7.4155824961,1.7685392823,3.0257887436,2.5247100896,11.547974153,2.8310630176,0.7312862328,1.6362653458,2.333431878],[8.2900068486,5.4724827192,9.8908077118,6.1782452531,5.7172536705,8.1376908363,7.5799702035,3.7322703983,12.3650197056,40.3594841217,37.0620252201,240.366521196,5.7233659544,6.2434091852,12.8800193798,16.2036462924,6.3769591811,6.3349124392,16.9989566694,4.7019175548,2.1002055933,10.8695593839,4.6287652326,4.0280527136,5.3575491198,13.2870636756,3.8087523998,0.8321767417,1.8863270714,2.8253686162],[3.7664169961,2.2518459399,3.7894774674,2.7889264324,6.3324396504,2.3467538331,14.1112007619,1.9362191379,7.6700813891,15.6253185425,13.2281048367,24.7737298913,112.8846453609,2.5647434017,4.2703690664,5.6004133632,3.6472706939,2.4438767489,6.5509539914,2.3069570738,0.9833243584,12.0306070664,1.6239203538,5.1675477473,2.4329665964,17.992170339,4.1457904348,0.8467249835,2.5247020552,4.2898472831],[5.3294642996,2.2913181297,4.0433097595,3.5025506135,5.2117147259,3.1060502266,10.246871004,2.2017741472,6.283308433,23.5834849383,21.6807192006,28.2100884077,3.2631628463,114.052559122,4.2668287641,7.530824155,2.7093287074,3.033627134,6.2361721547,2.0434035308,1.0480310545,9.9108662927,2.8548703114,3.5645333809,2.6841248517,13.9547152946,3.0811180137,0.6166053804,1.8500451146,2.5703489481],[15.055410855,7.4956640035,17.9464653113,11.996119306,26.9876127582,9.290120886,50.7506935927,8.0383081093,24.3123586784,59.5333997042,45.351836173,74.6757947832,10.7554559887,7.1896599073,558.0072418441,21.2199118707,10.9010452928,7.6020260153,21.8219893546,6.0313142256,2.5024445258,34.4200591951,6.0669321473,12.6143704891,6.7340051412,58.355487886,13.5802325913,2.6147954418,9.307178827,12.8844403227],[14.7949299998,9.3863817092,14.2460536104,9.1224200551,16.5160794225,10.3546935422,25.2462851257,6.3520901077,18.5131654536,57.0601103321,55.355101196,45.2144159042,7.4578608696,7.1276057381,17.023764339,268.784993914,8.2752998572,8.7485096563,18.4972594225,5.7893216079,3.3922556274,28.5519289929,7.251137819,9.3531745937,8.6031531138,42.1860144701,10.4475077547,2.1291969323,6.5472458906,11.2363689353],[4.4955349523,2.5236516836,4.361843759,3.7689298368,7.5546042683,2.6756449759,13.1213117653,2.1558109947,7.0106791632,16.6993373402,13.0399929965,27.9788095599,3.0697704078,2.3981446626,4.3966135482,6.4816385123,141.7865110346,2.4695702721,7.2624961622,2.3705239078,0.9571190546,13.2074451317,1.9127573148,5.6166306442,2.9443959136,21.7265089162,4.7083590336,0.9396470533,2.9507629966,4.4939129188],[3.6870263452,2.7646436402,4.2372760428,3.1568996978,4.8515957216,2.7253365178,7.3759370176,1.5307839041,6.0381428965,14.2826654249,16.5086010007,15.6508347043,2.5880067406,2.5761301202,4.6380189475,6.9944881958,2.583469922,136.5937307425,7.375359874,2.3963447984,1.4370454881,13.149592725,2.057065814,4.7493595248,4.2440281781,13.8450766348,3.5268109483,0.6325906049,2.1139583682,2.9112942485],[5.9953960718,3.6857812944,7.2467591177,5.2957366652,11.8093424076,4.2003464316,24.5588455512,3.4894264826,12.1278002131,29.365123734,22.9306384284,41.3494665432,5.4140386259,4.2237991315,8.4875433641,10.6451263861,6.1687940418,4.5109439316,147.4600347304,5.0146850364,2.6333050569,25.9325359284,3.3698805246,12.6265332287,5.2985347374,36.0938662295,8.6403071229,1.8041109632,5.0499500897,9.5696571643],[3.404503892,1.6143612654,2.7440894759,2.0883245972,1.9779876459,2.4503551493,1.3158225783,1.1670512572,3.6857288317,16.3804671302,18.2851113361,5.4049895506,2.8938338246,1.6153879123,3.9247138408,5.9225519453,2.1163133519,3.6598353008,8.2770703287,230.2817733726,2.331347664,6.6912024625,3.5150016188,2.392295311,4.3608041573,2.7258330363,1.1502970799,0.2370040703,0.5931198935,0.6892239867],[0.2691528134,0.1937595822,0.4134264472,0.2885572371,0.3488863383,0.177503726,0.1416988489,0.150796043,0.2905417325,0.9031990951,0.5612563601,0.6364498337,0.420043915,0.3465037128,0.5561961875,1.0251626748,0.492657177,0.5198850154,1.2888306889,0.458342543,21.8107599087,0.3677206561,0.173156166,0.3541273988,0.2885711146,0.3880418395,0.1215911556,0.0386296137,0.0720573638,0.1191765598],[2.9362082619,1.4036000613,2.8789870165,1.5554658852,2.1997884427,1.7984432219,1.0519884984,0.820946903,2.2361021514,7.3096308959,6.5666374135,3.0354455789,1.593576388,1.906842452,3.737355037,6.3808236656,2.143347518,3.2582483924,6.4686225743,2.1184440213,0.5257582821,126.0125547421,2.0928582709,1.6664451197,2.5032140879,3.048591637,1.2907124986,0.4190494452,0.5174042316,1.0469813277],[1.5344465736,1.6442215755,3.0004333687,1.1899948465,1.760630635,1.3306720954,1.1587152986,0.4955721899,2.0980084282,8.125853609,4.9215948445,3.5327189383,1.7081190218,1.6587763017,2.5680205259,4.7057289165,1.8807528625,2.7180249512,3.8126030841,1.7743938508,0.5771573211,4.4079249195,309.4718750768,1.329189533,3.620668755,2.3764808966,1.8975873609,0.4042855177,0.6524783376,1.5563765252],[1.1531931083,0.8733460888,1.4182366331,0.9676809232,0.9740323232,1.0232914612,0.6348095757,0.495360521,1.6468451182,6.7487558493,7.1315622113,2.2481193056,0.9526719189,1.1582253425,1.832635728,2.6402613567,1.6158088518,2.3819638149,5.1547176185,1.2635676896,0.7591970504,3.6940864661,1.2661628126,54.9698216126,3.1100859994,1.3127901282,0.7405848269,0.1881693252,0.369871256,0.3991115342],[1.4259200899,0.6229963128,1.5471644374,0.7541189495,0.8706167191,1.1947162105,0.7301559592,0.5704032183,1.4144467812,8.9385766653,6.8408921766,3.281456956,1.5934498023,1.1039855597,2.3339369039,4.5322488206,1.7476361123,2.0869802444,3.7805510338,1.2656902193,0.5119035613,3.1187631384,2.0809574233,1.2897724377,95.8068027792,1.484278321,0.5693093947,0.1814401001,0.222784253,0.3886057481],[4.8000251056,3.8582078527,10.2154565054,5.5626189951,6.4059049349,4.1597102296,3.344644434,5.8842309597,14.4218635416,38.501926262,32.8157950895,10.9781720345,8.946729424,6.3766244932,7.6549562533,12.9848366997,9.6171172789,7.3371566035,15.1915690377,2.4938888781,1.0037025705,8.7734012588,3.7130416474,2.7650329396,3.9991484229,195.6912273785,2.0399400786,1.0364302065,4.8019495505,5.6777331797],[3.1224016658,1.6929629981,2.7833394951,2.0567212477,2.5790402769,1.9093727018,2.9745883787,1.2386781765,2.5986081779,13.241496025,11.6392955543,6.2871021155,2.1819487638,1.5054675916,3.5621421331,6.9253530292,2.4021781295,2.5124255155,4.6119536382,1.4661170672,0.6066627403,6.6688280226,3.3999214444,1.5546610723,1.6800164972,6.5645357956,119.2098067912,0.9489698061,1.1303554935,1.9716992055],[1.2231166661,0.6601147567,1.1598774097,0.9934070338,0.9293752894,0.7387265277,0.4389411188,0.7620092222,1.5458485088,6.1801924288,5.4620607681,1.842318957,1.1344469233,0.6580128591,0.9194491345,1.9730293904,0.8169249602,0.8943724461,1.6121896072,0.3965801939,0.2421272879,2.3471410267,1.0212394144,0.5123029147,0.9986616717,1.5080225439,1.3681434043,29.9966156564,0.9671525692,1.2142077192],[0.7506978491,0.3541323848,0.9038610909,0.7170660616,0.7050952545,0.6438869849,0.5877839518,0.4812032183,0.7204780995,4.3757507536,3.5641377847,1.4518006384,0.4459580499,0.484031191,0.8123963285,1.6390006172,0.8322616286,0.9483617896,1.9691247175,0.3821136646,0.1554765527,1.2204208127,0.7034313739,0.3519244048,0.3671208304,0.8667408598,0.3567935496,0.1739650069,18.8369971524,0.4402199433],[9.7836588363,4.9964058096,13.3147427544,5.0787081183,8.1460670532,6.0953675056,3.3913428477,8.3723897728,19.8015371426,41.386884006,37.1236924764,11.2518577904,11.7843073127,10.2472126414,10.5476823576,14.3300857513,13.996860392,4.4078190201,11.1334442089,2.4003367136,1.2575185889,12.1132140029,4.8576774976,2.3499214013,3.242983066,14.470824466,5.1246671606,1.2251125038,9.8068036298,301.8143771441]];
        
        const rows = matrix.length;
        const cols = matrix[0].length;

        // 计算每一列的和(碳流入) 可以用静态数据
        const colSum = new Array(cols).fill(0);
        for (let i = 0; i < rows; i++) {
            for (let j = 0; j < cols; j++) {
                colSum[j] += matrix[i][j];
            }
        }

        // 计算每一行的和(碳流出) 可以用静态数据
        const rowSum = new Array(rows).fill(0);
        for (let i = 0; i < rows; i++) {
            for (let j = 0; j < cols; j++) {
                rowSum[i] += matrix[i][j];
            }
        }   

        // 将二维数组转换为ECharts热力图所需的格式 
        // const data = [];
        // for (let i = 0; i < matrix.length; i++) {
        //     for (let j = 0; j < matrix[i].length; j++) {
        //         data.push([i, j, matrix[i][j]]); // xAxis yAxis 值
        //     }
        // }

        // ///////////////////////////////////
        // 1.绘制热力图 heatmap
        const heatmap = echarts.init(document.getElementById('heatmap'));
        heatmap.setOption({
            title: {
                text: '碳转移热力图',
            },
            grid: {
                left: '10%',
                right: '',
                top: "10%",
                bottom: '',
            },
            tooltip: {
                position: 'top',
                formatter: function (params) {
                    return '碳转移' + '<br/>' + 
                        // '行：' + params.data[1] + '<br/>' +
                        // '列：' + params.data[0] + '<br/>' +
                        provinces[params.data[1]] + ' -> ' + provinces[params.data[0]] + ': ' + 
                        params.data[2].toFixed(3); // 值保留3位小数
                }
            },
            xAxis: {
                type: 'category',
                data: xData,
                position: 'top', // 翻转X轴到最上面
                axisLabel: {
                    rotate: 270  // 将xAxis英文字体水平旋转270度
                }
            },
            yAxis: {
                type: 'category',
                data: yData,
                inverse: true, // 翻转Y轴（翻转前数据在第1象限，翻转后在第4象限） 
            },
            visualMap: { // 就是那个可以拖拽范围的
                min: 0,
                // max: Math.max(...matrix.flat()), 
                max: 53,
                calculable: true, // 是否显示拖拽用的手柄
                orient: 'vertical', // 设置为垂直
                left: "0",          // 距离容器的左侧
                bottom: '-0.5%',    // 距离容器的底部
                inRange: {
                    color: ['#fecc5c','#fd8d3c','#f03b20','#bd0026']
                },
                // show: false, // 不显示
            },
            series: [{
                type: 'heatmap',
                // 先对每一行进行 map 操作，将每个元素映射为 [j, i, value]，然后将结果展平一层。
                data: matrix.flatMap((row, i) => row.map((value, j) => [j, i, value])), 
                label: {
                    show: false // 不显示标签
                },
                emphasis: {
                    itemStyle: {
                        shadowBlur: 10,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }]
        });


        /////////////////////////////////////
        // 2.绘制底部柱状图 bar_bottom
        const bar_bottom = echarts.init(document.getElementById('bar-a'));
        bar_bottom.setOption({
            title: {
                text: '碳流入柱状图',
                show: false,
            },
            grid: {
                left: '7.9%',
                right: '20%',
                top: "",
                bottom: '',
            },
            tooltip: {
                trigger: 'axis', // 可选 'item' 或 'axis'
                axisPointer: {
                    type: 'shadow' // 可选 'line' 或 'shadow'
                },
                formatter: function (params) {
                    var result = '';
                    params.forEach(function (item) {
                        result += '碳流入<br/>' + provinces[item.dataIndex] + ": " + item.value.toFixed(3) + '<br/>';
                    });
                    return result;
                }
            },
            xAxis: {
                type: 'category',
                data: xData,
                axisLine: {
                lineStyle: {
                    color: 'transparent'  // 将轴线颜色设置为透明
                }
            }
            },
            yAxis: {
                type: 'value',
                inverse: true,
                show: false,
            },
            series: [{
                name: "碳流入",
                data: colSum,
                type: 'bar',
                inverse: true,
                barWidth: '90%', // 设置柱子的宽度
                barGap: '0%',
                
                itemStyle: {
                    color: '#a0d9d0' // 设置柱状图的颜色为粉红色
                }
            }]
        })

        /////////////////////////////////////
        // 3.绘制右侧柱状图 bar_right
        const bar_right = echarts.init(document.getElementById('bar-b'));
        bar_right.setOption({
            title: {
                text: '碳流出柱状图',
                show: false,
            },
            grid: {
                left: '0', 
                top: '91px', 
                width: '', 
                height: '700px',
            },
            tooltip: {
                trigger: 'axis', 
                axisPointer: {
                    type: 'shadow' 
                },
                formatter: function (params) {
                    var result = '';
                    params.forEach(function (item) {
                        result += '碳流出<br/>' + provinces[item.dataIndex] + ": " + item.value.toFixed(3) + '<br/>';
                    });
                    return result;
                }
            },
            xAxis: {
                show: false,
            },
            yAxis: {
                type: 'category', 
                data: yData, 
                boundaryGap: false, 
                axisLine: {onZero: false},
                show: false,
                inverse: true,
            },
            series: [{
                type: 'bar', 
                data: rowSum,
                barWidth: '90%', // 设置柱子的宽度
                barGap: '0%',
                tooltip:{
                    trigger: 'axis', 
                    axisPointer: {
                        type: 'shadow' 
                    },
                    formatter: function (params) {
                        var result = '';
                        params.forEach(function (item) {
                            result += '碳流出<br/>' + item.name + ": " + item.value.toFixed(3) + '<br/>';
                        });
                        return result;
                    }
                },
                itemStyle: {
                    color: '#fc939e' // 设置柱状图的颜色为粉红色
                }
            }]
        })

  </script>
</body>
</html>
