<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ECharts 碳转移图</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <style>
        html, body{
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        #main {
            width: 1000px; /* 设置图表的宽度 */
            height: 1000px; /* 设置图表的高度 */
            position: relative; /* 使子元素可以使用绝对定位 */
        }

        /* 实际是720*720的矩形 */
        #heatmap { 
            position: absolute;
            width: 80%; 
            height: 80%; 
            /* background-color: lightblue; 背景颜色仅用于演示 */
        }

        #bar-b {
            position: absolute;
            /* top: 0; */
            left: 80%; 
            width: 10%; 
            height: 80%; 
            /* background-color: lightcoral; 背景颜色仅用于演示 */
        }

        #bar-a {
            position: absolute;
            top: 80%; 
            width: 100%; 
            height: 10%; 
            /* background-color: lightgreen; 背景颜色仅用于演示 */
        }
    </style>
</head>

<body>
  <!-- 创建一个用于放置图表的容器 -->
   <div id="main">
        <div id="heatmap"></div>
        <div id="bar-a"></div>
        <div id="bar-b"></div>
   </div>

  
  <script>
        const yData =  ["BJ", "TJ", "HE", "SX", "IM", "LN", "JL", "HL", "SH", "JS", "ZJ", "AH", "FJ", "JX", "SD", "HA", "HB", "HN", "GD", "GX", "HI", "CQ", "SC", "GZ", "YN", "SN", "GS", "QH", "NX", "XJ"];
        
        const xData =  ["BJ", "TJ", "HE", "SX", "IM", "LN", "JL", "HL", "SH", "JS", "ZJ", "AH", "FJ", "JX", "SD", "HA", "HB", "HN", "GD", "GX", "HI", "CQ", "SC", "GZ", "YN", "SN", "GS", "QH", "NX", "XJ"];
        
        const provinces = ["北京", "天津", "河北", "山西", "内蒙古", "辽宁", "吉林", "黑龙江", "上海","江苏", "浙江", "安徽", "福建", "江西", "山东", "河南", "湖北", "湖南", "广东","广西", "海南", "重庆", "四川", "贵州", "云南", "陕西", "甘肃", "青海", "宁夏", "新疆"]

        // 用的静态数据
        const matrix = [[17.7584177878,0.8584749584,1.1332585818,0.6630044272,0.8191416603,0.7383883047,1.115940787,0.4691805129,1.1274330386,2.1318801313,0.992369901,1.3229709417,0.3259113806,0.4625556917,1.5398917473,1.5197765897,0.5581824911,0.4562994731,1.2005920036,0.3160225353,0.1065607629,0.7437884839,0.3439249571,0.2638358337,0.3307523765,1.3965692837,0.3589185088,0.0912093828,0.1935068756,0.4449191846],[4.9143037771,84.0411594378,3.8668172763,1.5177318223,5.3684771419,4.1444345926,8.7016860021,3.5713128157,6.4757616719,11.2325348099,6.20585917,8.1028911919,1.4475479493,1.432086231,5.2618660584,3.9540527292,1.1733890669,1.4531571087,6.2634616196,1.3492726565,0.7440281692,3.4617210713,1.3137344669,1.44451217,0.8870492829,9.1580087464,2.3965580296,0.687161562,1.3009529626,2.9720997349],[31.3791454002,10.2571345518,399.5157044537,9.7740119818,26.1793202494,19.7971240977,35.9998161781,17.3217798675,41.7899000994,87.1298064332,56.0710653572,47.9055911616,8.9032288329,7.8809623364,18.9505295138,23.3055621811,4.8410077553,11.4345493601,53.5951792529,7.0916077355,4.7770321089,25.113621137,8.4962850431,8.3544324004,6.4430434479,46.6835851433,12.9016647693,3.4946659306,6.3510782578,16.512151096],[13.0154439049,4.9723336965,11.234578182,199.3058136915,22.0814580141,9.5614234514,30.4082000361,9.8143823117,21.6231816926,37.111219721,19.2589577696,30.1661325413,4.5554611465,4.7163640161,15.6815656037,9.7721813622,7.2108958982,5.4816004998,20.5347221632,4.8042394831,2.2079148671,13.9474551547,4.3240627775,6.3386234498,3.0815791592,40.0105867653,10.565489024,3.1851162608,5.7642071419,12.1768328417],[20.6557774831,10.130152841,16.12708666,11.9965365408,530.2653062082,15.5714824814,5.79495586,17.5023512923,28.274659109,68.2624025366,46.7242390402,19.2645687566,8.0207286743,7.3597483261,30.7655920778,16.3148883155,13.3784772069,9.1047233245,42.0401374197,7.203038827,3.4562714918,10.0303755998,6.2950038907,3.1634692887,4.6737082874,16.8882866401,5.4436480438,1.2219314319,4.3919763531,10.3552314695],[13.7115831985,7.3189463047,10.492408184,5.0804006701,14.3691956088,243.7556011037,33.9474075561,13.3537474429,21.0774189095,37.0738973001,19.9142717558,23.1775943924,3.938682381,4.2744434299,10.5738569844,11.1567938593,3.2369823048,5.6678501286,19.202529179,3.9090918744,2.1171756877,11.4448176017,4.0195521735,4.7626385973,3.7139390972,25.5426896058,7.4533153771,2.089708926,3.8061042032,10.196529609],[6.0071273942,4.3344829067,4.8337987813,3.635365912,4.0695715039,9.6675197542,234.3154399249,13.0609731,7.0878732523,10.9870641658,7.82834758,3.0042469777,2.5304504157,2.1132843383,9.715623814,4.0932726508,1.637664506,2.066151558,5.8551899325,1.5798211346,0.7849869644,1.6624423747,1.9310667055,0.8462810493,1.0135033597,4.3540699738,1.1687589456,0.3889211003,1.0951097252,1.8239504362],[2.9467674335,2.1736181938,3.6212578975,1.6628529088,3.580562991,5.6232326073,9.9941312531,79.7902066464,4.8765749358,7.6395404825,4.9852206226,4.7689980287,1.4242582588,1.4795972835,5.9872682447,3.5417786113,1.3233897751,1.6111679098,4.9025715923,1.1448711263,0.5326501392,1.9315739338,1.2502124529,0.8053861134,0.8839792111,5.50782911,1.3251273409,0.3821988233,0.8390091008,1.9368414117],[1.7544542017,1.1299697771,3.2484151005,1.1769326811,2.0522703748,2.2125172744,3.8755178722,1.7024784301,75.1519110738,5.7365969575,3.3546437535,4.9044458296,0.9903154223,1.3799981957,2.6845284694,3.7695088192,0.6463643317,1.350185333,3.3980317135,1.0795109234,0.3394072104,1.8128875653,0.890565628,0.9077281849,0.9263371199,4.4391712547,1.2437754172,0.3187195321,0.5810868956,1.4206726673],[7.7482761096,7.2767826734,29.2165795609,6.8805020585,14.490565214,16.8163941685,3.5066724902,4.4331164723,10.9747125876,807.5033409396,11.8642792216,12.6132882116,2.7519250407,10.7151202301,9.8124104431,25.0291668971,3.447604677,9.0609559697,18.2411671444,5.8953002372,1.3599088357,4.9500235202,6.3538442419,3.1657784812,7.3289295156,8.4403211273,4.8243226288,0.8771543684,1.8850483329,3.1383942777],[7.9050419414,4.0582473024,10.2648163081,4.7601626469,10.4353385018,7.6143562611,22.1838676193,6.3533889923,18.7003292163,26.5491032649,179.1535119739,26.1124372731,2.599015218,4.3824840199,9.3560867442,9.6564051843,2.8813854881,3.9510006356,11.1995812801,3.8532926761,1.5926071108,9.5840863989,3.0694775809,4.7547723591,3.0556984334,25.8903324013,6.7877426892,2.0194834495,3.369207731,8.6644905052],[10.8556614311,5.4094506146,11.8807929105,6.4400261313,7.9896041527,7.4315831397,7.5583299988,4.6298170407,15.8623224145,31.9314414559,16.2892406249,232.0541081603,2.9180903624,5.9979064223,10.6503338824,11.9398528258,4.613570598,5.6988252707,17.1202158247,3.8950357962,1.5354816712,6.9365676938,3.7752042794,2.8217865886,4.004236203,13.9947820792,3.5816517956,0.8581072782,1.6349791943,3.1051772719],[4.7674095502,2.2348091829,4.3659759832,2.3580336688,7.2475151892,3.8346413917,14.9123518791,4.3203030548,10.8154901136,15.7679392509,5.6347503468,16.2965050771,125.5138301902,2.1602868658,5.3012725379,3.8098507547,1.900601098,1.9795509786,6.6470092779,2.0883125988,1.0857525273,6.8354132424,1.696215611,3.5973660982,1.5578534438,17.6099208528,4.7365025245,1.3906286504,2.3078670451,5.8221618136],[4.8515196019,1.8081523704,3.7412144413,2.3251191166,4.343798943,3.3556822565,7.9398332962,3.1407448068,8.5564752907,16.7218571366,9.2885325389,14.0363321771,1.7397828096,105.1076006398,3.6643553874,4.3994702689,1.254664662,2.3434734035,8.274397996,1.4143180882,0.8989026009,4.8336988915,1.6198644084,1.8885785595,1.5335302196,10.6144314876,2.61396294,0.7071776863,1.2699938193,2.8387820099],[21.1553482249,10.8312045197,15.8523949562,11.0247529268,28.5295743538,14.6411447453,49.2040289968,19.529370206,35.3812723495,54.5049665797,25.0291191822,51.2583266482,5.8913086267,6.2711589714,568.7104031647,16.5674160972,5.5863246492,6.8954688333,31.0430965952,6.8457420132,3.7278609416,20.331983268,7.2358308695,10.0201511453,5.2004812027,56.0492618504,15.0790144733,4.2909210337,7.7490454692,17.9128664562],[20.6349269647,8.9061156968,15.1850378779,7.4999342618,16.6884467749,11.742931513,24.5721462318,10.5511116574,29.3018000178,53.9436722166,28.5261159045,31.8560018686,5.1434385453,6.7829493821,17.0319050157,315.4895323024,6.2447069188,8.7589221738,28.103576,5.4311153904,3.4752128171,18.0226316704,5.3140352666,6.6623277022,6.1623759439,39.3083429541,10.0613847734,2.7426387503,5.1790913771,13.2795274154],[4.013906882,1.6194564244,3.2638969477,3.0874860164,5.4589958517,3.1506195063,9.1386756426,3.1767869004,6.9956275915,12.8595362748,5.3425291429,12.6755634299,1.6032153764,1.4312336134,4.2444201612,4.1225638909,196.2718536435,1.6983800464,5.3616516257,1.5282728823,0.7953182326,5.0402440889,1.4793307326,2.5966525146,1.2690642316,13.6001569431,3.2977872854,0.9307759835,1.6859242667,3.6327033513],[6.2871167784,2.9639931515,6.0023940411,3.1289903306,7.5553337767,5.5560904407,11.5244419893,4.4844179085,11.7966791098,21.0739667794,11.316852712,15.5770405379,2.5040491776,2.9327441224,6.8664303532,7.2662583217,2.3503383685,163.6836581476,14.1296859423,2.6360741229,1.7168666196,8.9647619786,2.5652774916,4.097563853,2.8721438571,17.5765209847,4.8545958385,1.320292718,2.2678761823,5.4139468161],[9.7971875775,4.4430236663,10.5302484379,5.586550072,15.7880636017,8.4799766986,31.1051708403,8.8185748572,20.6525417381,31.817760342,11.9833286329,33.0316597353,3.7294969459,4.5709309231,12.3386872858,9.4635456323,3.6426958071,4.8297127578,188.3689315823,5.3855842373,2.7817942949,16.4459725029,3.6698208683,9.3777874904,4.0685839244,40.4893309276,10.9492620263,3.326902616,5.208838319,13.9279543757],[2.8193394889,1.0565214405,2.5132616635,1.4597359397,1.8316200278,1.9636637513,0.7811230179,1.1590534139,3.7349955481,8.3473032422,6.4921885703,3.1100478554,1.1877222744,1.2270761217,2.625386306,3.1768055129,0.8382815287,2.3530030539,9.3223769927,160.1695081771,1.3784332521,3.236571742,1.5376332813,1.1753880879,2.2877354769,2.3590557188,0.7195818386,0.1535877971,0.3643688733,0.6718317853],[0.2187101726,0.2020425245,0.5484762182,0.2805835019,0.4166739782,0.3567221697,0.1180467013,0.2259480546,0.2057406244,0.5416716942,0.4326594038,0.3921744674,0.1972152144,0.2512503477,0.8627774708,0.8024560791,0.1677831811,0.4269337111,0.7984681929,0.3087320477,20.5910596367,0.2482941658,0.2312002201,0.1760698266,0.2815605191,0.3575513458,0.116585064,0.0292818157,0.047305336,0.1563353454],[3.2797344713,1.5712524207,4.6026500554,2.0109273948,2.9158615026,3.3485010501,1.0918010652,1.2315843652,3.7394281926,8.2687486859,6.0685894987,3.4944981858,1.2285707248,2.1859103552,4.0806032849,6.42323596,1.8685302562,3.3767022736,9.5427298996,2.2384963102,0.663658083,129.0170626938,2.5083920126,1.4489898733,2.3931207615,3.274469002,1.3891740832,0.2595488391,0.540901167,1.075988019],[3.9539513891,2.0488895944,4.6372331483,2.1055416794,5.5225774521,3.7407693923,7.9063246325,3.3074733258,7.0606813131,13.7723294545,6.9090687989,9.1059216128,1.912155407,2.0121286885,5.56436765,4.2564670522,2.1276598617,2.5655175301,8.1557420109,2.2770101178,1.1895861644,7.8856651626,239.4788064383,3.1826004505,2.7719131803,13.2290809335,4.4843755071,1.21289066,1.8998723791,5.0840208849],[6.0541990806,2.0752790226,4.5732510877,2.9236689083,3.0293415565,3.5662996351,1.7935210101,1.8008555818,5.8910083285,14.2641580705,10.5769337866,4.8980988402,1.9077810161,3.3846031145,5.3805759978,5.2630079333,5.3002433362,3.3625731164,16.4669300686,3.1628506577,1.1512982673,5.4793491412,2.4309487332,187.1666787541,2.1471312874,4.8694112552,1.1631924699,0.2338434244,0.5508201198,1.1712275497],[4.361784514,1.0600108017,3.8698433562,1.1398006399,1.9160241251,3.4857858684,1.2278856061,1.7917578047,5.3019097437,12.801421305,10.5858109551,5.1492820444,1.912075563,1.5262077975,3.5324585506,5.3060614762,1.3952888792,2.5431508514,12.9950542942,1.4600226087,1.1213740039,4.1878599726,2.1107695177,0.8101460949,140.5125462895,3.2235283117,0.8851819668,0.1406846947,0.3033096988,1.0462283509],[5.7621155738,4.3370255648,7.9536757768,4.0291756355,4.8090462355,10.0485532458,2.2537801593,12.644219779,13.5819894023,23.5411561672,19.3808109234,7.2467581277,5.1079145543,4.058837355,20.801652692,7.2896694301,4.9396931965,4.6159240414,17.5230493093,4.68307293,2.7826336424,4.6138495079,4.5319354519,1.5968246749,2.1969480749,172.2355306068,1.6627678985,0.7999022544,2.7497108568,4.4651709931],[3.9971032053,1.3362830193,3.7319151778,1.7825505556,2.4883405336,3.065770429,1.9253635615,1.9666723952,4.3666015161,9.4903125515,7.5151361992,3.9379031156,1.7103162665,1.4044774279,3.5451169336,4.9246801557,1.3881581213,2.1938440026,7.8360579022,1.0865208814,0.6350085256,3.5148220933,2.2517388285,0.7588926356,1.052669655,4.3051290585,125.4985984842,0.4604882537,0.7084331295,1.3057251847],[0.8341330624,0.509699869,0.9754670248,0.3763554985,0.4825272731,1.5228102543,0.2647794768,1.8677427142,1.703442344,3.2892051977,2.6033123258,0.811196889,0.7406335016,0.4926415532,2.8277649196,0.7372946765,0.3861796121,0.3853703544,2.2631139101,0.6624424969,0.4429458033,0.5709779188,0.5051155694,0.1572965087,0.2053589269,1.0034879023,0.3490955174,29.4107579011,0.4809514961,0.6475854268],[1.0642669913,0.3962304921,0.9038459852,0.5377508073,0.7940255989,0.8588362941,0.4031615228,0.5741216887,1.5023896179,3.681954872,2.7914633571,1.3482603507,0.3896753704,0.3866343682,0.7979422623,1.2591634398,0.5145979873,0.7182488247,2.9633322691,0.3619143177,0.1622193327,0.8513386868,0.5084453015,0.2137546969,0.3070615137,0.8808969139,0.3107783659,0.0784817682,17.4775357758,0.3901791188],[8.1462099891,4.4186450812,8.697327144,2.6829109655,5.0505855689,12.5184515619,1.8374701432,15.3434615497,14.4931398002,21.5025649719,18.2789003277,5.794555606,5.0969863059,3.6091495111,22.4922313374,7.3685465393,2.9959229551,3.637676005,16.5924454129,4.6751555322,3.350580208,4.0923313079,4.0505789542,1.2014180221,1.8037086561,7.6652004142,2.0302933647,0.9098832745,3.0080778448,222.936340295]];

        const rows = matrix.length;
        const cols = matrix[0].length;

        // 计算每一列的和(碳流入) 可以用静态数据
        const colSum = new Array(cols).fill(0);
        for (let i = 0; i < rows; i++) {
            for (let j = 0; j < cols; j++) {
                colSum[j] += matrix[i][j];
            }
        }

        // 计算每一行的和(碳流出) 可以用静态数据
        const rowSum = new Array(rows).fill(0);
        for (let i = 0; i < rows; i++) {
            for (let j = 0; j < cols; j++) {
                rowSum[i] += matrix[i][j];
            }
        }   

        // 将二维数组转换为ECharts热力图所需的格式 
        // const data = [];
        // for (let i = 0; i < matrix.length; i++) {
        //     for (let j = 0; j < matrix[i].length; j++) {
        //         data.push([i, j, matrix[i][j]]); // xAxis yAxis 值
        //     }
        // }

        // ///////////////////////////////////
        // 1.绘制热力图 heatmap
        const heatmap = echarts.init(document.getElementById('heatmap'));
        heatmap.setOption({
            title: {
                text: '碳转移热力图',
            },
            grid: {
                left: '10%',
                right: '',
                top: "10%",
                bottom: '',
            },
            tooltip: {
                position: 'top',
                formatter: function (params) {
                    return '碳转移' + '<br/>' + 
                        // '行：' + params.data[1] + '<br/>' +
                        // '列：' + params.data[0] + '<br/>' +
                        provinces[params.data[1]] + ' -> ' + provinces[params.data[0]] + ': ' + 
                        params.data[2].toFixed(3); // 值保留3位小数
                }
            },
            xAxis: {
                type: 'category',
                data: xData,
                position: 'top', // 翻转X轴到最上面
                axisLabel: {
                    rotate: 270  // 将xAxis英文字体水平旋转270度
                }
            },
            yAxis: {
                type: 'category',
                data: yData,
                inverse: true, // 翻转Y轴（翻转前数据在第1象限，翻转后在第4象限） 
            },
            visualMap: { // 就是那个可以拖拽范围的
                min: 0,
                // max: Math.max(...matrix.flat()), 
                max: 53,
                calculable: true, // 是否显示拖拽用的手柄
                orient: 'vertical', // 设置为垂直
                left: "0",          // 距离容器的左侧
                bottom: '-0.5%',    // 距离容器的底部
                inRange: {
                    color: ['#fecc5c','#fd8d3c','#f03b20','#bd0026']
                },
                // show: false, // 不显示
            },
            series: [{
                type: 'heatmap',
                // 先对每一行进行 map 操作，将每个元素映射为 [j, i, value]，然后将结果展平一层。
                data: matrix.flatMap((row, i) => row.map((value, j) => [j, i, value])), 
                label: {
                    show: false // 不显示标签
                },
                emphasis: {
                    itemStyle: {
                        shadowBlur: 10,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }]
        });


        /////////////////////////////////////
        // 2.绘制底部柱状图 bar_bottom
        const bar_bottom = echarts.init(document.getElementById('bar-a'));
        bar_bottom.setOption({
            title: {
                text: '碳流入柱状图',
                show: false,
            },
            grid: {
                left: '7.9%',
                right: '20%',
                top: "",
                bottom: '',
            },
            tooltip: {
                trigger: 'axis', // 可选 'item' 或 'axis'
                axisPointer: {
                    type: 'shadow' // 可选 'line' 或 'shadow'
                },
                formatter: function (params) {
                    var result = '';
                    params.forEach(function (item) {
                        result += '碳流入<br/>' + provinces[item.dataIndex] + ": " + item.value.toFixed(3) + '<br/>';
                    });
                    return result;
                }
            },
            xAxis: {
                type: 'category',
                data: xData,
                axisLine: {
                lineStyle: {
                    color: 'transparent'  // 将轴线颜色设置为透明
                }
            }
            },
            yAxis: {
                type: 'value',
                inverse: true,
                show: false,
            },
            series: [{
                name: "碳流入",
                data: colSum,
                type: 'bar',
                inverse: true,
                barWidth: '90%', // 设置柱子的宽度
                barGap: '0%',
                
                itemStyle: {
                    color: '#a0d9d0' // 设置柱状图的颜色为粉红色
                }
            }]
        })

        /////////////////////////////////////
        // 3.绘制右侧柱状图 bar_right
        const bar_right = echarts.init(document.getElementById('bar-b'));
        bar_right.setOption({
            title: {
                text: '碳流出柱状图',
                show: false,
            },
            grid: {
                left: '0', 
                top: '91px', 
                width: '', 
                height: '700px',
            },
            tooltip: {
                trigger: 'axis', 
                axisPointer: {
                    type: 'shadow' 
                },
                formatter: function (params) {
                    var result = '';
                    params.forEach(function (item) {
                        result += '碳流出<br/>' + provinces[item.dataIndex] + ": " + item.value.toFixed(3) + '<br/>';
                    });
                    return result;
                }
            },
            xAxis: {
                show: false,
            },
            yAxis: {
                type: 'category', 
                data: yData, 
                boundaryGap: false, 
                axisLine: {onZero: false},
                show: false,
                inverse: true,
            },
            series: [{
                type: 'bar', 
                data: rowSum,
                barWidth: '90%', // 设置柱子的宽度
                barGap: '10%',
                tooltip:{
                    trigger: 'axis', 
                    axisPointer: {
                        type: 'shadow' 
                    },
                    formatter: function (params) {
                        var result = '';
                        params.forEach(function (item) {
                            result += '碳流出<br/>' + item.name + ": " + item.value.toFixed(3) + '<br/>';
                        });
                        return result;
                    }
                },
                itemStyle: {
                    color: '#fc939e', // 设置柱状图的颜色为粉红色
                }
            }]
        })

  </script>
</body>
</html>
