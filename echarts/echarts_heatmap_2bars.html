<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ECharts 碳转移图</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <style>
        html, body{
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        #main {
            width: 1000px; /* 设置图表的宽度 */
            height: 1000px; /* 设置图表的高度 */
            position: relative; /* 使子元素可以使用绝对定位 */
        }

        /* 实际是720*720的矩形 */
        #heatmap { 
            position: absolute;
            width: 80%; 
            height: 80%; 
            /* background-color: lightblue; 背景颜色仅用于演示 */
        }

        #bar-b {
            position: absolute;
            /* top: 0; */
            left: 80%; 
            width: 10%; 
            height: 80%; 
            /* background-color: lightcoral; 背景颜色仅用于演示 */
        }

        #bar-a {
            position: absolute;
            top: 80%; 
            width: 100%; 
            height: 10%; 
            /* background-color: lightgreen; 背景颜色仅用于演示 */
        }
    </style>
</head>

<body>
  <!-- 创建一个用于放置图表的容器 -->
   <div id="main">
        <div id="heatmap"></div>
        <div id="bar-a"></div>
        <div id="bar-b"></div>
   </div>

  
  <script>
        const yData =  ["BJ", "TJ", "HE", "SX", "IM", "LN", "JL", "HL", "SH", "JS", "ZJ", "AH", "FJ", "JX", "SD", "HA", "HB", "HN", "GD", "GX", "HI", "CQ", "SC", "GZ", "YN", "SN", "GS", "QH", "NX", "XJ"];
        
        const xData =  ["BJ", "TJ", "HE", "SX", "IM", "LN", "JL", "HL", "SH", "JS", "ZJ", "AH", "FJ", "JX", "SD", "HA", "HB", "HN", "GD", "GX", "HI", "CQ", "SC", "GZ", "YN", "SN", "GS", "QH", "NX", "XJ"];
        
        const provinces = ["北京", "天津", "河北", "山西", "内蒙古", "辽宁", "吉林", "黑龙江", "上海","江苏", "浙江", "安徽", "福建", "江西", "山东", "河南", "湖北", "湖南", "广东","广西", "海南", "重庆", "四川", "贵州", "云南", "陕西", "甘肃", "青海", "宁夏", "新疆"]

        // 用的静态数据
        const matrix = [[22.2757090112,0.7801028513,2.2272403162,1.1188168336,1.235844638,0.9220693606,0.5447469413,1.2876286632,0.9130273418,1.968974954,2.3730982578,1.341732086,0.5729090009,2.7381961481,1.9110639762,6.0365427917,0.7867606726,2.16468441,4.9929379801,0.7647499025,0.1531949459,2.8022191992,1.0240877634,0.8997316775,0.6162682069,1.9687217563,0.2488158976,0.0999216332,0.4330321418,0.7267601314],[4.2181472883,104.3360485527,3.4459503797,2.1255947769,2.3937371424,2.6066827954,1.856211054,1.333650453,1.9275766817,5.0489205789,6.7001684735,2.0106432048,0.7345061745,1.593397962,2.9663539678,5.5106579574,0.7353035709,1.1439603986,5.6221361203,0.9817695766,0.3430357274,2.830535621,1.2243802553,0.9849522827,0.9220661431,2.4197217789,0.331067154,0.1453240162,0.4443995192,0.8665770251],[25.5897742928,9.1551781624,541.7736489611,31.5518956965,19.9542841185,11.8155829153,9.1701429363,7.2245840585,8.5398304443,28.1521125475,48.7394884421,13.4338135285,4.0630843433,9.9071689792,17.5560600142,30.3914304604,3.4905673293,6.5844529519,43.0119632106,6.0136063354,2.3796038072,22.0580545878,10.162901057,7.5228535184,8.1858935078,19.3885808376,2.235240515,1.2928568401,2.8875425302,7.7486625694],[18.1526291331,5.6103438533,42.2899029963,300.769974034,9.1636157128,5.6842730378,3.9642057212,5.3985392506,7.3475703796,33.606723905,34.9158776958,10.6819081138,2.5468675392,14.8692115646,9.4665444808,32.5349704539,4.4915774588,11.2906833594,28.3960951796,5.1283682661,1.9389647585,13.2010072422,4.9584505356,5.5913616183,4.2681172848,11.8605917906,1.4733194547,0.7101760038,1.3691397188,3.7305629429],[41.9777810648,9.1013896499,27.9255160024,14.8371852147,383.2682543525,9.2403033784,7.5502049412,7.5887409876,10.2939428467,29.3333691119,35.6672665551,15.0508644783,4.6578249736,24.9712508526,16.233987287,53.0595821208,6.3536642259,19.891481008,51.2173729528,7.0021511831,2.1011779229,25.7137607532,8.3870434293,7.3675317464,6.9572640721,20.1947119685,2.6842773267,1.3623267287,2.2706830823,8.0815612074],[13.0129192325,5.4707904689,9.0444766915,4.3845891405,5.6336547253,330.7751158808,12.7076683528,9.7877800187,6.0498872608,14.1267273352,22.242308592,7.5757693534,2.8538868855,7.3824373003,9.1332554541,21.600210311,2.4998905388,6.0170414843,22.4519115912,3.2022942547,1.1733215161,10.6303618391,4.0771649187,3.5311710251,3.2053035171,7.6845276588,1.1755252073,0.4961091616,1.2139086206,2.9204974745],[2.7335957969,2.9077849621,3.5942972886,1.4030592161,3.0605435185,7.7970396916,139.5452983195,19.4581049279,4.2403893726,5.8950748318,9.3704859405,2.0681817517,1.8981929138,2.597124093,5.3340216526,7.3208486698,1.5657574252,2.3164600943,10.0367179449,1.62389186,1.0092886994,3.3181318087,1.8171092601,2.1517489915,2.9022181854,4.5135633066,0.8056747695,0.1810251182,0.539513786,1.9485759846],[16.5717849172,2.9862131124,7.862627625,4.2564889769,4.6167933984,7.7782978484,18.4786822406,90.1362103669,4.5830138147,12.5011977591,11.1628964153,5.2709192574,1.8824528848,10.4415903313,5.8870362372,20.0510855002,2.9058565485,7.9975052755,17.0145741324,2.530972731,0.6208060012,8.2798482247,2.3520901108,2.3766282443,1.9643557386,6.9342147697,0.8158856946,0.425153501,0.8314770355,2.2719247955],[2.5382231766,1.503163269,2.3345927335,2.6003390103,2.0385821438,2.1510957437,1.8757577188,1.4489155464,76.3019758132,6.8338972308,16.2234491198,3.2237948848,1.0915230675,1.8782660981,3.7216919416,6.9882176457,1.3316671152,1.4350828853,10.6628778962,1.4736762641,0.5660857941,4.0133113819,2.0104732192,1.6610307536,1.6188027388,2.8262702101,0.4150057879,0.1662948709,0.6825259827,1.1274515379],[9.3499987384,9.8613594169,13.1738676732,19.9172040589,15.6587608449,11.6991746833,6.1846512914,5.9242336863,12.2955783953,830.4196988413,33.5574297793,19.7765647976,4.1579079887,9.4108356938,20.397082063,27.2933926052,6.1324776845,6.8745139913,27.9367272498,6.3900059174,2.1773328352,10.9990621587,7.4392790232,7.9691022051,7.3587019653,16.8368788105,2.4660774401,0.9425099091,2.3793768256,6.7780558832],[6.7837654596,2.9526691543,5.2466679429,14.3774233158,8.9356090024,3.0611128291,2.7218889568,2.0330921282,23.1527255722,9.5945728316,270.1834652175,4.5556415153,2.8725597596,5.9799730823,8.2464138516,12.7752391057,2.2077756209,3.952238277,13.2066980095,2.2794310528,0.5190968616,4.6035356545,2.0306230091,4.2133428641,2.185802818,7.4461697659,0.8066008182,0.3466868156,1.1629919177,1.8799180785],[3.5183115642,3.7146998919,5.4886641565,3.6797941037,4.7863703153,6.1401679901,2.2363899111,1.4340104238,6.7016186298,38.7317467096,12.1092301587,372.1521401059,2.3987226033,5.5151483543,8.5777802675,10.2594584866,3.2717316024,3.4251912316,11.9689168793,2.6843392454,1.1096703814,5.1166417856,2.9172632307,3.4275471223,4.0889296544,6.6968122144,1.3587827391,0.3501492524,1.13280808,2.9461006699],[6.0869929303,1.5702507397,3.2738939484,1.5180503803,2.2757721774,2.5350216018,1.6267215963,1.2309027779,2.844291681,4.3213363734,8.2969716609,3.2335871831,191.3237556994,5.5394427009,2.1097943105,8.6597938101,1.0269123833,4.3625740884,14.6032642505,1.6673261099,0.8660411158,5.193804863,1.3180836288,2.1163423046,2.3443258865,4.173478324,0.5816380804,0.177802457,0.3768882637,1.3948575354],[4.6447871903,3.1752853449,5.1665942908,4.7319243746,5.3729901408,4.8433523722,2.7913478673,2.1044439679,5.1701503109,8.2893065705,15.0138415193,5.8008171912,2.0674592543,212.1184840318,5.5628927438,9.4227907432,5.2649156569,3.8657832294,15.0771066099,2.489062521,1.4062732258,5.9316960701,3.0318336699,4.4859040518,4.4453288406,7.4799364269,1.1999129472,0.2863277613,0.9800573672,2.8227177166],[25.2938807702,6.0199230244,17.5529367855,5.9260807729,7.7223612171,7.9126057645,5.4675812308,4.9531545513,10.2721575584,23.6646874867,28.3891748458,11.0303880382,2.549934195,15.8008888888,762.3485794153,33.3330554833,3.7960468768,12.5750710938,34.1881671279,4.470261452,1.9745921008,15.3486103225,4.6305703866,5.6049425029,5.7577586504,12.5835593751,1.672395092,0.7088144143,1.3285024582,4.182898035],[10.188247022,9.5030068489,13.7805680478,8.707046875,12.7157414035,14.4953453881,7.078126297,4.7735242015,14.7316429443,19.1769895548,36.3401913019,8.4829868307,3.8462256435,9.0478718941,12.9980664346,405.4157207644,3.6877331444,8.2619644838,39.9394744188,5.4715074982,4.071102605,16.3993283334,6.3560308023,10.1858141814,11.525201709,23.8452104605,3.3241995233,0.7643150301,2.3912755588,8.1651585544],[3.4397129724,1.1245332976,2.0418574156,1.6882580591,1.6717633008,1.3322972797,1.6431284921,0.8059599115,2.6069242727,4.2984521131,4.9329987999,2.4670715679,0.6389797885,12.9396592358,1.6709564416,5.6413457539,269.6691672042,2.6680813057,6.8895006102,0.8356610058,0.4316287565,2.9823049837,0.9598113491,1.1462892496,0.9422602864,2.3172391409,0.2808449018,0.153789472,0.3055436599,1.0449868276],[1.9762153934,1.7379884534,2.5009716548,2.3234032982,2.9215493893,2.657028398,1.4547632148,0.9022059933,3.060791409,4.9592097516,6.7525612388,1.8087831406,1.3967055938,2.960189271,3.0743452933,5.76148518,1.3614824895,198.8406474023,10.9317156024,1.3779806489,1.0111064199,3.3478648038,1.3286199325,2.5234983297,2.5669768259,4.4524993519,0.8179222826,0.1183521584,0.6122515761,1.5321179717],[5.8272596265,3.762754264,6.1614310365,6.7317639121,7.2778449696,5.6817760747,3.5311126547,2.9450661352,7.251006794,9.21814391,14.3210892885,3.4449972829,4.3916473022,6.319530446,8.5557607887,16.4600999318,2.9247467395,5.7387385907,413.5302852656,6.29258356,2.385520266,7.6763052902,4.7478289569,7.8345341583,5.7350416254,9.3070633889,1.7497280814,0.3974183757,1.5688729132,3.5653529222],[2.2179896683,2.3266463378,3.3469929991,2.0709546979,3.2225843258,3.4910874747,2.1290397114,1.0176429338,4.5227842167,5.3376303765,10.4954689071,2.3237842653,1.3809746173,2.8764645387,3.047064048,6.9007779479,0.9529720116,2.7666713068,21.9360204114,181.226100348,2.6524619756,6.5202335842,2.404643314,3.9314714408,4.2842246527,5.5146834307,0.9666904872,0.212070536,0.6876370395,1.9202198022],[0.4964864329,0.2772652426,0.4512551552,0.3356260877,0.3457231263,0.2413924258,0.3813031289,0.1369486804,0.4837834113,1.0261090148,0.658783598,0.3758450519,0.4437354069,0.6733322223,0.6512944657,1.9833364082,0.2003714279,0.4604234319,2.5371147305,1.0410920464,22.5663500519,0.4964018689,0.2591551194,0.6376423959,0.3105824559,0.5485783168,0.12376743,0.0251891244,0.1092681369,0.2189531134],[2.5522173708,1.4666860929,2.8426262718,1.2714543288,2.113303768,2.1161860286,1.1730415899,0.9606835006,2.706687377,3.8930925937,4.5665047193,1.5630398573,1.3812000105,2.018987958,3.4921731178,6.2037186525,1.2641070132,1.6771550474,6.4177052107,1.9065287612,0.490073779,119.0255889389,5.8411711269,2.542865145,1.9584884158,3.5828130968,1.0125578453,0.2046383306,0.6000685812,1.9319623817],[3.5204633081,1.2682001059,3.0163787073,0.9774412155,1.5875689718,1.6629901243,1.3504623019,0.7199750169,2.7749124571,5.1904752783,2.6864499452,2.2926075648,0.8799859635,3.0225993259,1.8883819103,5.689463622,0.6762910784,2.328293263,7.0067305117,1.3742397987,0.4080129099,4.8616710334,303.9989163934,1.4816901485,1.4007926327,2.9966435744,1.1399460037,0.2033433275,0.4691387972,1.2679611569],[6.2448851471,2.144290048,5.2170008242,2.4565724221,2.7647958446,3.287650967,2.3316355071,1.5844989764,4.2734155823,7.6798172109,10.7571297613,3.304611133,1.9736147514,5.455357755,4.6668637814,12.5465563344,1.7279620903,4.6156819135,19.213969785,3.6065395341,1.5294829835,8.7226256195,2.7951097061,179.3343928645,3.957638771,5.4015687639,1.2732505944,0.2669072384,0.7970511882,2.1874648834],[1.7461117157,1.0034032242,4.1642191352,1.293646533,1.5053451915,1.2324395445,1.725213463,0.7968233486,2.5830836026,6.7582335053,7.0002409372,2.4204841954,1.4201285264,3.0967347386,2.7015098308,7.9943268105,0.856490328,2.3569301286,10.1106960066,2.384377793,0.8202864581,4.3077471439,1.8171618625,2.3500620366,143.2528687106,2.5362834496,0.6298264128,0.1531682151,0.3723115756,1.0710803514],[10.1463849973,3.5365775155,10.2993342762,4.6000750517,4.8544207096,3.9209614629,2.6561861093,2.7093950593,4.8518082861,13.9824334753,15.5237037364,5.1918196872,1.980513501,8.7130534011,6.3664644464,21.0892295474,2.8689342666,7.4453301336,18.2286172421,3.5136400447,1.1390878109,10.1188495851,3.4971702264,3.9528428891,3.3616577184,127.7304405508,1.9892484155,0.5251365267,1.2104185758,3.3066441082],[3.9389084513,1.1218857035,3.445227642,1.699939793,2.2314673855,1.7349842619,1.9967952809,1.1651901648,1.9827837447,4.6803971967,7.6939075607,2.8268742179,0.9192264569,2.7901119557,2.5936894318,8.1115283065,0.8423471106,2.5035929576,10.9129365533,1.6004227254,0.686256163,6.9153428997,3.4998011547,2.2611195615,2.1612026929,6.1136116125,104.1484443703,2.9137737841,0.5457169009,1.8498600747],[0.3541549848,0.4921205751,0.8714238947,0.3248894223,0.6586836153,0.4839045082,0.3192869083,0.4483567212,0.7754118128,2.4994095344,2.3749406952,0.4681446629,0.1867536512,0.6630503123,0.7500918859,1.7260061945,0.5085975074,0.7307689525,1.3586854258,0.5821725997,0.105458842,1.0403944288,0.449466325,0.3213212649,0.3146004802,1.0585724713,0.9899023341,49.2969941547,0.388623299,1.3801034662],[10.4158337384,3.2516874428,8.2494038814,3.2672785646,4.5144339718,3.9962809199,2.1256615171,2.4533323492,4.7668023016,8.985244457,12.431839551,4.5075679248,1.4267898518,6.8866852853,4.6340420121,14.2614306839,1.9933818038,5.5519481186,16.1374593844,2.7081016985,0.973635607,8.0198335011,3.2185085685,2.6213871546,2.4480368154,7.6451152436,1.0379512076,0.6898288827,132.723192969,5.5106483822],[18.6757003901,3.8925017342,12.6242626682,4.8883748792,7.4523178988,5.8638681223,5.390170112,4.0551021102,6.7178999517,20.2539489269,16.7624243827,8.554292669,3.2178631082,12.6592460132,8.3313389482,29.1241467608,4.9164405594,11.7814537834,27.160221606,5.1581921922,1.5120604461,17.8422065965,6.582890028,5.0870385034,4.8542124038,13.2993265034,2.2495555875,1.9674439555,3.5241020594,290.8861541229]];
        const rows = matrix.length;
        const cols = matrix[0].length;

        // 计算每一列的和(碳流入) 可以用静态数据
        const colSum = new Array(cols).fill(0);
        for (let i = 0; i < rows; i++) {
            for (let j = 0; j < cols; j++) {
                colSum[j] += matrix[i][j];
            }
        }

        // 计算每一行的和(碳流出) 可以用静态数据
        const rowSum = new Array(rows).fill(0);
        for (let i = 0; i < rows; i++) {
            for (let j = 0; j < cols; j++) {
                rowSum[i] += matrix[i][j];
            }
        }   

        // 将二维数组转换为ECharts热力图所需的格式 
        // const data = [];
        // for (let i = 0; i < matrix.length; i++) {
        //     for (let j = 0; j < matrix[i].length; j++) {
        //         data.push([i, j, matrix[i][j]]); // xAxis yAxis 值
        //     }
        // }

        // ///////////////////////////////////
        // 1.绘制热力图 heatmap
        const heatmap = echarts.init(document.getElementById('heatmap'));
        heatmap.setOption({
            title: {
                text: '碳转移热力图',
            },
            grid: {
                left: '10%',
                right: '',
                top: "10%",
                bottom: '',
            },
            tooltip: {
                position: 'top',
                formatter: function (params) {
                    return '碳转移' + '<br/>' + 
                        // '行：' + params.data[1] + '<br/>' +
                        // '列：' + params.data[0] + '<br/>' +
                        provinces[params.data[1]] + ' -> ' + provinces[params.data[0]] + ': ' + 
                        params.data[2].toFixed(3); // 值保留3位小数
                }
            },
            xAxis: {
                type: 'category',
                data: xData,
                position: 'top', // 翻转X轴到最上面
                axisLabel: {
                    rotate: 270  // 将xAxis英文字体水平旋转270度
                }
            },
            yAxis: {
                type: 'category',
                data: yData,
                inverse: true, // 翻转Y轴（翻转前数据在第1象限，翻转后在第4象限） 
            },
            visualMap: { // 就是那个可以拖拽范围的
                min: 0,
                // max: Math.max(...matrix.flat()), 
                max: 53,
                calculable: true, // 是否显示拖拽用的手柄
                orient: 'vertical', // 设置为垂直
                left: "0",          // 距离容器的左侧
                bottom: '-0.5%',    // 距离容器的底部
                inRange: {
                    color: ['#fecc5c','#fd8d3c','#f03b20','#bd0026']
                },
                // show: false, // 不显示
            },
            series: [{
                type: 'heatmap',
                // 先对每一行进行 map 操作，将每个元素映射为 [j, i, value]，然后将结果展平一层。
                data: matrix.flatMap((row, i) => row.map((value, j) => [j, i, value])), 
                label: {
                    show: false // 不显示标签
                },
                emphasis: {
                    itemStyle: {
                        shadowBlur: 10,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }]
        });


        /////////////////////////////////////
        // 2.绘制底部柱状图 bar_bottom
        const bar_bottom = echarts.init(document.getElementById('bar-a'));
        bar_bottom.setOption({
            title: {
                text: '碳流入柱状图',
                show: false,
            },
            grid: {
                left: '7.9%',
                right: '20%',
                top: "",
                bottom: '',
            },
            tooltip: {
                trigger: 'axis', // 可选 'item' 或 'axis'
                axisPointer: {
                    type: 'shadow' // 可选 'line' 或 'shadow'
                },
                formatter: function (params) {
                    var result = '';
                    params.forEach(function (item) {
                        result += '碳流入<br/>' + provinces[item.dataIndex] + ": " + item.value.toFixed(3) + '<br/>';
                    });
                    return result;
                }
            },
            xAxis: {
                type: 'category',
                data: xData,
                axisLine: {
                lineStyle: {
                    color: 'transparent'  // 将轴线颜色设置为透明
                }
            }
            },
            yAxis: {
                type: 'value',
                inverse: true,
                show: false,
            },
            series: [{
                name: "碳流入",
                data: colSum,
                type: 'bar',
                inverse: true,
                barWidth: '90%', // 设置柱子的宽度
                barGap: '0%',
                
                itemStyle: {
                    color: '#a0d9d0' // 设置柱状图的颜色为粉红色
                }
            }]
        })

        /////////////////////////////////////
        // 3.绘制右侧柱状图 bar_right
        const bar_right = echarts.init(document.getElementById('bar-b'));
        bar_right.setOption({
            title: {
                text: '碳流出柱状图',
                show: false,
            },
            grid: {
                left: '0', 
                top: '91px', 
                width: '', 
                height: '700px',
            },
            tooltip: {
                trigger: 'axis', 
                axisPointer: {
                    type: 'shadow' 
                },
                formatter: function (params) {
                    var result = '';
                    params.forEach(function (item) {
                        result += '碳流出<br/>' + provinces[item.dataIndex] + ": " + item.value.toFixed(3) + '<br/>';
                    });
                    return result;
                }
            },
            xAxis: {
                show: false,
            },
            yAxis: {
                type: 'category', 
                data: yData, 
                boundaryGap: false, 
                axisLine: {onZero: false},
                show: false,
                inverse: true,
            },
            series: [{
                type: 'bar', 
                data: rowSum,
                barWidth: '90%', // 设置柱子的宽度
                barGap: '0%',
                tooltip:{
                    trigger: 'axis', 
                    axisPointer: {
                        type: 'shadow' 
                    },
                    formatter: function (params) {
                        var result = '';
                        params.forEach(function (item) {
                            result += '碳流出<br/>' + item.name + ": " + item.value.toFixed(3) + '<br/>';
                        });
                        return result;
                    }
                },
                itemStyle: {
                    color: '#fc939e' // 设置柱状图的颜色为粉红色
                }
            }]
        })

  </script>
</body>
</html>
